# .github/workflows/generate-data.yml
name: Generar Datos Dashboard

on:
  schedule:
    - cron: '0 2 * * *'  # Todos los días a las 2 AM
  push:
    paths:
      - 'scripts/**'
      - 'data_raw/**'
  workflow_dispatch:  # Permite ejecución manual

jobs:
  generar-datos:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          # QUITAMOS EL CACHE PARA EVITAR EL ERROR
          # cache: 'pip'  ← ELIMINADO

      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install polars requests pyarrow

      - name: Ejecutar script de procesamiento
        run: |
          cd scripts
          python preparar_datos.py

      - name: Commit y push de datos generados
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/data/* || echo "No hay cambios en data/"
          git commit -m "Actualización automática de datos $(date +'%Y-%m-%d %H:%M')" || echo "Nada para commitear"
          git push || echo "No se pudo pushear (quizás no hay cambios)"
