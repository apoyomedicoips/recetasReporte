window.Dashboard=(function(){const u=window.DashboardUtils;const s={resumen:[],top:[]};async function c(){try{const r=await fetch("data/resumen_mensual.json");const t=await r.json();s.resumen=t;}catch(e){s.resumen=[];}try{const r=await fetch("data/top_medicamentos.json");const t=await r.json();s.top=t;}catch(e){s.top=[];}}function kpis(){if(!s.resumen.length)return;const ult=s.resumen[s.resumen.length-1];const elT=document.getElementById("kpi-total");const elP=document.getElementById("kpi-pacientes");const elM=document.getElementById("kpi-medicos");if(elT)elT.textContent=u.formatNumber(ult.total_lineas||0);if(elP)elP.textContent=u.formatNumber(ult.pacientes_unicos||0);if(elM)elM.textContent=u.formatNumber(ult.medicos_unicos||0);}function chart(){if(!s.resumen.length)return;const ctx=document.getElementById("chart-evolucion");if(!ctx)return;const labels=s.resumen.map(r=>r.anio+"-"+String(r.mes).padStart(2,"0"));const datos=s.resumen.map(r=>r.total_dispensado||0);new Chart(ctx,{type:"line",data:{labels:labels,datasets:[{label:"Dispensado",data:datos}]},options:{responsive:true,maintainAspectRatio:false}});}function tabla(){if(!s.top.length)return;const datos=s.top.slice(0,20);const table=$("#tabla-meds");if(!table.length)return;const cols=[{title:"Código",data:"MedicamentoSAP"},{title:"Líneas",data:"lineas"},{title:"Dispensado",data:"dispensado"},{title:"Recetado",data:"recetado"}];table.DataTable({data:datos,columns:cols,pageLength:10,lengthChange:false});}async function init(){await c();kpis();chart();tabla();}return{init:init};})();document.addEventListener("DOMContentLoaded",function(){if(window.Dashboard&&typeof window.Dashboard.init==="function"){window.Dashboard.init();}});